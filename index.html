<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="/removeRails.css">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.2/angular.js"></script>
    <script type="text/javascript" src="/removeRails.js"></script>
  </head>
  <body ng-app="removeRails">
    <h1>Get some data in ya!</h1>
    <div ng-controller="removeRailsController as ctrl">
      <div class="indexPresentationContainer">
        <div class="spinner" ng-if="ctrl.loading() && ctrl.surveyIndices() == null"></div>
        <div class="indexPresentation" ng-show="ctrl.surveyIndices()">
          <p>{{ ctrl.surveyIndices().length + ' Surveys found, click to view.' }}</p>
          <ul>
            <li ng-repeat="index in ctrl.surveyIndices()">
              <button class="surveyButton" ng-click="ctrl.loadSurvey(index.url)">{{ index.name }}</button>
            </li>
          </ul>
        </div> <!-- /indexPresentation -->
      </div> <!-- /indexPresentationContainer -->
      <div class="spinner" ng-if="ctrl.loading() && ctrl.getSurveyData() == null && ctrl.surveyIndices() != null"></div>
      <div id="dataPresentationContainer" ng-if="ctrl.getSurveyData() != null">
        <div class="surveyMeta">
          <span>Survey: </span><span ng-bind="ctrl.getSurveyData().name"></span>
          <span>Participants: </span><span ng-bind="ctrl.getSurveyData().participant_count"></span>
          <span>Respondants: </span><span ng-bind="ctrl.getSurveyData().submitted_response_count"></span>
          <span>Response rate: </span><span>{{ ((ctrl.getSurveyData().submitted_response_count / ctrl.getSurveyData().participant_count) * 100 | number: 2) + '%' }}</span>
        </div> <!-- /surveyMeta -->
        <div class="surveyVisualContainer">
          <div class="surveyVisual">
            <span>Themes:</span>
            <ul class="themes">
              <li ng-repeat="theme in ctrl.getSurveyData().themes">
                <p class="themeName">{{ theme.name }}</p>
                <ul>
                  <li ng-repeat="question in theme.questions">
                    <p>{{ question.description }}</p>
                    <p>Results:</p>
                    <p>{{ 'Average: ' + (question.collated_results.average | number: 2) }}</p>
                  </li>
                </ul>
              </li>
            </ul>
          </div> <!-- /surveyVisual -->
        </div> <!-- /surveyVisualContainer -->
      </div> <!-- /dataPresentationContainer -->
    </div> <!-- /ng-controller -->
  </body>
</html>
